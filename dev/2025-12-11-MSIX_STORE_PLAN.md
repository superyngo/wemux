# MSIX Packaging and Microsoft Store Distribution Plan

## Executive Summary

This document outlines the complete implementation plan for packaging wemux as an MSIX application and distributing it through the Microsoft Store.

---

## 1. Prerequisites

### 1.1 Microsoft Store Account

- [ ] Register for Microsoft Partner Center account ($19 one-time fee for individuals, $99 for companies)
- [ ] Complete tax and payout information
- [ ] Reserve app name "wemux" in Partner Center

### 1.2 Code Signing Certificate

- [ ] Obtain EV (Extended Validation) code signing certificate for Microsoft Store submission
- [ ] Alternative: Use Partner Center's internal signing (recommended for easier workflow)

### 1.3 Development Tools

- [ ] Install Windows 10 SDK (includes `makeappx.exe`, `signtool.exe`)
- [ ] Install Visual Studio 2022 (optional, but provides GUI tools)
- [ ] Install MSIX Packaging Tool (optional, for testing)

---

## 2. MSIX Package Structure

### 2.1 Required Files

```
wemux/
├── AppxManifest.xml          # Package manifest
├── wemux.exe                 # Main executable
├── assets/
│   ├── icons/
│   │   ├── Square44x44Logo.png       # Tile icon (44x44)
│   │   ├── Square150x150Logo.png     # Medium tile (150x150)
│   │   ├── Square310x310Logo.png     # Large tile (310x310)
│   │   ├── Wide310x150Logo.png       # Wide tile (310x150)
│   │   └── StoreLogo.png             # Store listing (50x50)
│   └── idle.png              # Existing tray icons
│   └── active.png
│   └── error.png
└── resources.pri              # (Auto-generated by MakePRI.exe)
```

### 2.2 Create AppxManifest.xml

**Location:** `D:\Users\user\Documents\rust\wemux\packaging\AppxManifest.xml`

```xml
<?xml version="1.0" encoding="utf-8"?>
<Package
  xmlns="http://schemas.microsoft.com/appx/manifest/foundation/windows10"
  xmlns:uap="http://schemas.microsoft.com/appx/manifest/uap/windows10"
  xmlns:rescap="http://schemas.microsoft.com/appx/manifest/foundation/windows10/restrictedcapabilities">

  <Identity
    Name="YourPublisherName.wemux"
    Publisher="CN=YourPublisherName"
    Version="0.3.0.0" />

  <Properties>
    <DisplayName>wemux</DisplayName>
    <PublisherDisplayName>Your Name</PublisherDisplayName>
    <Logo>assets\StoreLogo.png</Logo>
    <Description>Windows Multi-HDMI Audio Sync - Duplicate system audio to multiple HDMI devices</Description>
  </Properties>

  <Dependencies>
    <TargetDeviceFamily Name="Windows.Desktop" MinVersion="10.0.17763.0" MaxVersionTested="10.0.22621.0" />
  </Dependencies>

  <Resources>
    <Resource Language="en-us" />
    <Resource Language="zh-tw" />
  </Resources>

  <Applications>
    <Application Id="wemux" Executable="wemux.exe" EntryPoint="Windows.FullTrustApplication">
      <uap:VisualElements
        DisplayName="wemux"
        Description="Windows Multi-HDMI Audio Sync"
        BackgroundColor="transparent"
        Square150x150Logo="assets\Square150x150Logo.png"
        Square44x44Logo="assets\Square44x44Logo.png">

        <uap:DefaultTile
          Wide310x150Logo="assets\Wide310x150Logo.png"
          Square310x310Logo="assets\Square310x310Logo.png"
          Square71x71Logo="assets\Square71x71Logo.png">
        </uap:DefaultTile>

        <uap:SplashScreen Image="assets\SplashScreen.png" />
      </uap:VisualElements>

      <Extensions>
        <!-- Startup task for auto-start -->
        <uap:Extension Category="windows.startupTask">
          <uap:StartupTask
            TaskId="WemuxStartupTask"
            Enabled="false"
            DisplayName="wemux Audio Sync" />
        </uap:Extension>
      </Extensions>
    </Application>
  </Applications>

  <Capabilities>
    <!-- Full trust required for WASAPI loopback capture -->
    <rescap:Capability Name="runFullTrust" />
  </Capabilities>
</Package>
```

---

## 3. Icon Assets Creation

### 3.1 Required Sizes

Create PNG icons with transparency:

| File Name               | Size    | Purpose                  |
| ----------------------- | ------- | ------------------------ |
| `Square44x44Logo.png`   | 44x44   | App list, taskbar        |
| `Square71x71Logo.png`   | 71x71   | Small tile               |
| `Square150x150Logo.png` | 150x150 | Medium tile              |
| `Square310x310Logo.png` | 310x310 | Large tile               |
| `Wide310x150Logo.png`   | 310x150 | Wide tile                |
| `StoreLogo.png`         | 50x50   | Microsoft Store          |
| `SplashScreen.png`      | 620x300 | Launch screen (optional) |

### 3.2 Icon Design Guidelines

- Use the existing tray icon design as base
- Ensure 40% padding around icon content
- Use transparent backgrounds
- Follow Microsoft Fluent Design principles
- Test on both light and dark themes

### 3.3 Asset Creation Script

**Location:** `D:\Users\user\Documents\rust\wemux\scripts\generate_icons.ps1`

```powershell
# PowerShell script to generate all required icon sizes
# Requires ImageMagick or similar tool

$sourceIcon = "assets\idle.png"
$outputDir = "packaging\assets"

# Create output directory
New-Item -ItemType Directory -Force -Path $outputDir

# Generate required sizes
$sizes = @{
    "Square44x44Logo.png" = 44
    "Square71x71Logo.png" = 71
    "Square150x150Logo.png" = 150
    "Square310x310Logo.png" = 310
    "StoreLogo.png" = 50
}

foreach ($file in $sizes.Keys) {
    $size = $sizes[$file]
    # Using ImageMagick (install separately)
    magick convert $sourceIcon -resize "${size}x${size}" "$outputDir\$file"
}

# Wide tile (different aspect ratio)
magick convert $sourceIcon -resize "310x150" -background transparent -gravity center -extent 310x150 "$outputDir\Wide310x150Logo.png"

Write-Host "Icons generated successfully in $outputDir"
```

---

## 4. Settings Storage Modification

### 4.1 Current Implementation Issue

**Problem:** Current settings path uses executable directory, which is read-only in MSIX packages.

**File:** `src/tray/settings.rs:72-78`

### 4.2 Required Change

Update `settings_path()` function:

```rust
/// Get settings file path (MSIX-compatible)
fn settings_path() -> PathBuf {
    // Check if running as MSIX package
    if std::env::var("MSIX_PACKAGE_FAMILY_NAME").is_ok() {
        // Use LocalAppData for MSIX
        dirs::data_local_dir()
            .unwrap_or_else(|| PathBuf::from("."))
            .join("wemux")
            .join("wemux.toml")
    } else {
        // Use executable directory for non-MSIX
        std::env::current_exe()
            .ok()
            .and_then(|p| p.parent().map(|p| p.to_path_buf()))
            .unwrap_or_else(|| PathBuf::from("."))
            .join("wemux.toml")
    }
}
```

**Benefits:**

- MSIX packages: Settings stored in `%LOCALAPPDATA%\wemux\wemux.toml`
- Standalone EXE: Settings stored alongside executable (current behavior)
- Survives package updates
- Proper sandbox compliance

---

## 5. Build Process for MSIX

### 5.1 Packaging Directory Structure

Create packaging directory:

```bash
mkdir packaging
mkdir packaging/assets
mkdir packaging/output
```

### 5.2 Build Script

**Location:** `D:\Users\user\Documents\rust\wemux\scripts\build_msix.ps1`

```powershell
# MSIX Build Script for wemux
param(
    [string]$Version = "0.3.0.0",
    [string]$Configuration = "Release"
)

$ErrorActionPreference = "Stop"
$ProgressPreference = "SilentlyContinue"

Write-Host "Building wemux MSIX package v$Version" -ForegroundColor Cyan

# Paths
$projectRoot = Split-Path -Parent $PSScriptRoot
$packagingDir = Join-Path $projectRoot "packaging"
$stagingDir = Join-Path $packagingDir "staging"
$outputDir = Join-Path $packagingDir "output"
$manifestTemplate = Join-Path $packagingDir "AppxManifest.xml"

# Clean and create staging directory
if (Test-Path $stagingDir) {
    Remove-Item -Recurse -Force $stagingDir
}
New-Item -ItemType Directory -Force -Path $stagingDir | Out-Null
New-Item -ItemType Directory -Force -Path $outputDir | Out-Null

# Step 1: Build Rust application
Write-Host "Step 1: Building Rust application..." -ForegroundColor Yellow
Push-Location $projectRoot
cargo build --release
if ($LASTEXITCODE -ne 0) {
    throw "Cargo build failed"
}
Pop-Location

# Step 2: Copy executable
Write-Host "Step 2: Copying executable..." -ForegroundColor Yellow
Copy-Item (Join-Path $projectRoot "target\release\wemux.exe") $stagingDir

# Step 3: Copy assets
Write-Host "Step 3: Copying assets..." -ForegroundColor Yellow
$assetsDir = Join-Path $stagingDir "assets"
New-Item -ItemType Directory -Force -Path $assetsDir | Out-Null

# Copy tray icons
Copy-Item (Join-Path $projectRoot "assets\*.png") $assetsDir

# Copy MSIX-specific icons
Copy-Item (Join-Path $packagingDir "assets\*.png") $assetsDir -Force

# Step 4: Update manifest version
Write-Host "Step 4: Updating manifest version..." -ForegroundColor Yellow
$manifestContent = Get-Content $manifestTemplate -Raw
$manifestContent = $manifestContent -replace 'Version="[\d\.]+"', "Version=`"$Version`""
$manifestPath = Join-Path $stagingDir "AppxManifest.xml"
Set-Content -Path $manifestPath -Value $manifestContent

# Step 5: Create MSIX package
Write-Host "Step 5: Creating MSIX package..." -ForegroundColor Yellow
$msixPath = Join-Path $outputDir "wemux_${Version}_x64.msix"

& makeappx.exe pack /d $stagingDir /p $msixPath /o
if ($LASTEXITCODE -ne 0) {
    throw "makeappx.exe failed"
}

# Step 6: Sign package (if certificate available)
$certPath = Join-Path $packagingDir "wemux_cert.pfx"
if (Test-Path $certPath) {
    Write-Host "Step 6: Signing package..." -ForegroundColor Yellow

    # Prompt for certificate password
    $certPassword = Read-Host "Enter certificate password" -AsSecureString

    & signtool.exe sign /fd SHA256 /a /f $certPath /p (ConvertFrom-SecureString $certPassword -AsPlainText) $msixPath

    if ($LASTEXITCODE -ne 0) {
        Write-Warning "Package signing failed, but package created successfully"
    }
} else {
    Write-Host "Step 6: Skipping signing (no certificate found)" -ForegroundColor Yellow
    Write-Host "  For Store submission, signing will be done by Microsoft" -ForegroundColor Gray
}

Write-Host "`nMSIX package created successfully!" -ForegroundColor Green
Write-Host "  Output: $msixPath" -ForegroundColor White
Write-Host "  Size: $([math]::Round((Get-Item $msixPath).Length / 1MB, 2)) MB" -ForegroundColor White

# Step 7: Validate package
Write-Host "`nValidating package..." -ForegroundColor Yellow
& makeappx.exe validate /p $msixPath

Write-Host "`nBuild complete!" -ForegroundColor Green
```

### 5.3 Make Script Executable

```powershell
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
```

---

## 6. Testing MSIX Package Locally

### 6.1 Install Self-Signed Certificate (Development Only)

```powershell
# Generate self-signed certificate for testing
$cert = New-SelfSignedCertificate -Type Custom -Subject "CN=wemux Dev" `
    -KeyUsage DigitalSignature -FriendlyName "wemux Development Certificate" `
    -CertStoreLocation "Cert:\CurrentUser\My" `
    -TextExtension @("2.5.29.37={text}1.3.6.1.5.5.7.3.3", "2.5.29.19={text}")

# Export certificate
$certPath = "packaging\wemux_dev_cert.pfx"
$certPassword = ConvertTo-SecureString -String "YourPassword123" -Force -AsPlainText
Export-PfxCertificate -Cert $cert -FilePath $certPath -Password $certPassword

# Trust the certificate
Import-PfxCertificate -FilePath $certPath -CertStoreLocation Cert:\LocalMachine\Root -Password $certPassword
```

### 6.2 Install MSIX Package

```powershell
# Install unsigned package (requires Developer Mode enabled)
Add-AppxPackage -Path "packaging\output\wemux_0.3.0.0_x64.msix"

# OR install signed package
Add-AppxPackage -Path "packaging\output\wemux_0.3.0.0_x64.msix"
```

### 6.3 Test MSIX Application

```powershell
# Launch from Start Menu or:
explorer.exe shell:AppsFolder\YourPublisherName.wemux_xxxxxxxxxxxx!wemux

# Check settings location
$env:LOCALAPPDATA\wemux\wemux.toml

# View logs (if debug mode)
Get-AppxPackageManifest -Package "YourPublisherName.wemux*"
```

### 6.4 Uninstall

```powershell
Get-AppxPackage *wemux* | Remove-AppxPackage
```

---

## 7. Microsoft Store Submission

### 7.1 Partner Center Setup

1. **Create New App:**

   - Navigate to https://partner.microsoft.com/dashboard
   - Select "Apps and games" → "New product"
   - Choose "MSIX or PWA app"
   - Reserve name: "wemux"

2. **App Identity:**

   - Note down the generated values:
     - Package/Identity/Name
     - Package/Identity/Publisher
   - Update these in `AppxManifest.xml`

3. **Pricing and Availability:**
   - Select "Free"
   - Markets: Worldwide or specific regions
   - Release date: Immediate or scheduled

### 7.2 Store Listing Information

**Required Fields:**

- **Description (500-10,000 characters):**

  ```
  wemux is a powerful Windows audio utility that duplicates your system audio
  to multiple audio output devices simultaneously. Perfect for multi-room audio setups,
  presentations, or playing audio through multiple speakers, headphones, or displays at once.

  KEY FEATURES:
  • Easy system tray interface - control everything with a right-click
  • Toggle individual audio devices on/off
  • Low-latency audio synchronization across all devices
  • Automatic audio device detection
  • Hot-plug support for connecting/disconnecting devices
  • Remembers your device preferences

  TECHNICAL DETAILS:
  • Uses WASAPI loopback for high-quality audio capture
  • Master-slave clock synchronization keeps devices in sync
  • Supports Windows 10 and Windows 11

  Perfect for:
  - Multi-room audio distribution
  - Presentation setups with multiple displays
  - Entertainment systems with multiple audio devices
  - Any scenario requiring synchronized audio across multiple outputs
  ```

基於 wemux 的功能，我為您構思了以下產品功能列表（繁體中文版本）：

## App 功能列表（最多 20 項）

1. **同步輸出至多個音訊裝置** - 同時將系統音訊傳送到所有已啟用的音訊輸出裝置
2. **系統托盤快速控制** - 右鍵點擊托盤圖示即可控制所有功能
3. **個別裝置開關切換** - 獨立控制每個音訊裝置的啟用或停用
4. **低延遲音訊同步** - 所有裝置之間的音訊延遲小於 50 毫秒
5. **自動偵測音訊裝置** - 自動識別系統中所有可用的音訊輸出裝置
6. **熱插拔即時支援** - 連接或拔除裝置時自動更新裝置列表
7. **記憶裝置偏好設定** - 自動儲存您的裝置啟用狀態和設定
8. **高品質音訊擷取** - 使用 WASAPI 環回技術確保無損音質
9. **主從時鐘精確同步** - 專業級時鐘同步演算法保持音訊一致性
10. **輕量級背景運行** - 低 CPU 和記憶體使用率，不影響系統效能
11. **即時音訊處理** - 無緩衝延遲的即時音訊串流
12. **支援所有音訊格式** - 相容系統支援的所有音訊編碼格式
13. **視覺化狀態指示** - 托盤圖示顯示當前運作狀態（閒置/工作中/錯誤）
14. **一鍵啟動/停止引擎** - 快速切換音訊同步功能的開關
15. **智慧錯誤處理** - 自動偵測並處理裝置連線問題
16. **跨裝置音量同步** - 保持所有輸出裝置的音量一致
17. **支援 Windows 10 與 11** - 完整相容最新和舊版 Windows 系統
18. **無需額外驅動程式** - 使用 Windows 原生音訊 API，無需安裝驅動
19. **多房間音訊分配** - 適合家庭或辦公室的多房間音響系統
20. **簡潔直覺的使用介面** - 無複雜設定，安裝後立即可用

---

## 英文版本（供參考）

1. **Sync audio to multiple devices** - Simultaneously output system audio to all enabled audio devices
2. **System tray quick control** - Right-click tray icon for instant access to all features
3. **Individual device toggle** - Independently enable or disable each audio device
4. **Low-latency audio sync** - Less than 50ms latency between all devices
5. **Automatic device detection** - Auto-discover all available audio output devices
6. **Hot-plug support** - Instantly detect newly connected or removed devices
7. **Remember device preferences** - Automatically save your device settings
8. **High-quality audio capture** - Lossless audio using WASAPI loopback technology
9. **Master-slave clock sync** - Professional-grade synchronization algorithm
10. **Lightweight background operation** - Minimal CPU and memory footprint
11. **Real-time audio processing** - Zero-buffer delay audio streaming
12. **Support all audio formats** - Compatible with all system-supported codecs
13. **Visual status indicators** - Tray icon shows current state (idle/active/error)
14. **One-click engine toggle** - Quickly start or stop audio synchronization
15. **Smart error handling** - Auto-detect and handle device connection issues
16. **Cross-device volume sync** - Maintain consistent volume across outputs
17. **Windows 10 & 11 support** - Full compatibility with modern Windows versions
18. **No additional drivers needed** - Uses native Windows audio APIs
19. **Multi-room audio distribution** - Perfect for home or office sound systems
20. **Clean intuitive interface** - Ready to use right after installation

這些功能涵蓋了技術特性、使用者體驗和應用場景，可以根據實際需求調整順序或內容。

- **Screenshots (3-10 required):**

  - System tray icon and menu
  - Device selection dialog
  - Settings view
  - Multi-monitor setup example
  - Minimum 1366x768 PNG format

- **App Icon:** 300x300 PNG (upload to Store, separate from package icons)

- **Category:** Multimedia design → Audio

- **Age Rating:** IARC questionnaire (likely 3+ / Everyone)

### 7.3 Package Upload

1. **Prepare Upload:**

   - Build final MSIX package (unsigned)
   - Microsoft will sign it automatically

2. **Upload Process:**

   - Navigate to "Packages" section
   - Upload `wemux_0.3.0.0_x64.msix`
   - System validates package automatically
   - Check for any validation errors

3. **Supported Architectures:**
   - Consider building for ARM64 if needed:
     ```bash
     rustup target add aarch64-pc-windows-msvc
     cargo build --release --target aarch64-pc-windows-msvc
     ```

### 7.4 Certification Process

**Timeline:**

- Automated testing: 1-3 hours
- Manual review: 1-3 business days
- Total: Usually 24-48 hours

**Common Rejection Reasons:**

- Missing privacy policy (required even for free apps)
- Icon issues (wrong sizes, poor quality)
- App crashes during testing
- Missing capabilities in manifest
- Incorrect age rating

### 7.5 Privacy Policy

**Required Content:**

```
Privacy Policy for wemux

Last Updated: [Date]

wemux is a local audio processing application that does not collect,
store, or transmit any personal data.

Data Storage:
- Device preferences are stored locally on your computer
- No data is sent to external servers
- No analytics or telemetry is collected

Audio Processing:
- Audio is processed locally on your device
- No audio data leaves your computer
- The app accesses your audio devices with your permission

Contact:
For questions, contact: [Your Email]
```

Host this at: `https://github.com/superyngo/wemux/blob/main/PRIVACY.md`

---

## 8. GitHub Actions Workflow for MSIX

### 8.1 Workflow File

**Location:** `.github/workflows/msix-release.yml`

````yaml
name: MSIX Release

on:
  push:
    tags:
      - "v*.*.*"

permissions:
  contents: write

jobs:
  build-msix:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          targets: x86_64-pc-windows-msvc

      - name: Cache Rust dependencies
        uses: Swatinem/rust-cache@v2

      - name: Extract version from tag
        id: version
        run: |
          $tag = "${{ github.ref_name }}"
          $version = $tag -replace '^v', ''
          echo "VERSION=$version" >> $env:GITHUB_OUTPUT
          echo "VERSION_QUAD=$version.0" >> $env:GITHUB_OUTPUT

      - name: Build release
        run: cargo build --release

      - name: Setup packaging directory
        run: |
          New-Item -ItemType Directory -Force -Path packaging\staging
          New-Item -ItemType Directory -Force -Path packaging\staging\assets

      - name: Copy files to staging
        run: |
          Copy-Item target\release\wemux.exe packaging\staging\
          Copy-Item assets\*.png packaging\staging\assets\
          Copy-Item packaging\assets\*.png packaging\staging\assets\ -Force

      - name: Update manifest version
        run: |
          $version = "${{ steps.version.outputs.VERSION_QUAD }}"
          $manifest = Get-Content packaging\AppxManifest.xml -Raw
          $manifest = $manifest -replace 'Version="[\d\.]+"', "Version=`"$version`""
          Set-Content packaging\staging\AppxManifest.xml -Value $manifest

      - name: Create MSIX package
        run: |
          $version = "${{ steps.version.outputs.VERSION }}"
          & makeappx.exe pack /d packaging\staging /p "wemux_${version}_x64.msix" /o

      - name: Upload MSIX to release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            wemux_${{ steps.version.outputs.VERSION }}_x64.msix
          body: |
            ## wemux v${{ steps.version.outputs.VERSION }}

            ### Downloads
            - **MSIX Package (Microsoft Store format):** `wemux_${{ steps.version.outputs.VERSION }}_x64.msix`

            ### Installation
            - Download the MSIX file
            - Enable Developer Mode in Windows Settings
            - Double-click to install

            Or install via PowerShell:
            ```powershell
            Add-AppxPackage -Path wemux_${{ steps.version.outputs.VERSION }}_x64.msix
            ```
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
````

---

## 9. Automatic Updates Strategy

### 9.1 Microsoft Store Auto-Updates

**Advantages:**

- Automatic updates handled by Windows
- User doesn't need to do anything
- Delta updates (only changed files downloaded)

**Implementation:**

- Simply publish new version to Store
- Users get updates automatically within 24-48 hours

### 9.2 Update Notifications in App (Optional)

Add version check feature:

```rust
// src/tray/updater.rs
pub async fn check_for_updates() -> Result<Option<String>> {
    let current_version = env!("CARGO_PKG_VERSION");

    // Check GitHub releases API
    let response = reqwest::get(
        "https://api.github.com/repos/superyngo/wemux/releases/latest"
    ).await?;

    let release: serde_json::Value = response.json().await?;
    let latest_version = release["tag_name"]
        .as_str()
        .unwrap_or("")
        .trim_start_matches('v');

    if latest_version > current_version {
        Ok(Some(latest_version.to_string()))
    } else {
        Ok(None)
    }
}
```

---

## 10. Implementation Checklist

### Phase 1: Preparation (Week 1)

- [ ] Register Microsoft Partner Center account
- [ ] Reserve "wemux" app name
- [ ] Create privacy policy and host on GitHub
- [ ] Design and generate all required icon assets
- [ ] Update settings.rs for MSIX compatibility

### Phase 2: Local MSIX Build (Week 2)

- [ ] Create `packaging/` directory structure
- [ ] Write `AppxManifest.xml` with proper identity
- [ ] Create `build_msix.ps1` script
- [ ] Generate self-signed certificate for testing
- [ ] Build and test MSIX package locally
- [ ] Verify settings storage works correctly
- [ ] Test tray icon functionality in MSIX environment

### Phase 3: Store Preparation (Week 3)

- [ ] Take application screenshots
- [ ] Write Store description
- [ ] Complete age rating questionnaire
- [ ] Fill out all Store listing fields
- [ ] Create GitHub Actions workflow
- [ ] Test workflow with pre-release tag

### Phase 4: First Submission (Week 4)

- [ ] Build final MSIX package
- [ ] Submit to Microsoft Store
- [ ] Monitor certification status
- [ ] Address any rejection issues
- [ ] Publish after approval

### Phase 5: Post-Launch

- [ ] Monitor Store reviews
- [ ] Set up automated MSIX builds in CI/CD
- [ ] Plan update schedule
- [ ] Gather user feedback
- [ ] Iterate on improvements

---

## 11. Cost Breakdown

| Item                                  | Cost        | Frequency                       |
| ------------------------------------- | ----------- | ------------------------------- |
| Microsoft Partner Center (Individual) | $19 USD     | One-time                        |
| Microsoft Partner Center (Company)    | $99 USD     | One-time                        |
| EV Code Signing Certificate           | $0          | N/A (Store signs automatically) |
| Domain for Privacy Policy             | $10-15/year | Optional (can use GitHub)       |
| **Total (Individual)**                | **$19**     | **One-time**                    |

---

## 12. Alternative: WinGet Distribution

If Microsoft Store seems complex, consider Windows Package Manager (WinGet):

### 12.1 WinGet Manifest

**File:** `manifests/w/wemux/wemux/0.3.0.yaml`

```yaml
PackageIdentifier: wemux.wemux
PackageVersion: 0.3.0
PackageName: wemux
Publisher: Your Name
License: MIT
ShortDescription: Windows Multi-HDMI Audio Sync
Installers:
  - Architecture: x64
    InstallerType: msix
    InstallerUrl: https://github.com/superyngo/wemux/releases/download/v0.3.0/wemux_0.3.0_x64.msix
    InstallerSha256: [SHA256 hash]
ManifestType: singleton
ManifestVersion: 1.0.0
```

### 12.2 WinGet Submission

1. Fork https://github.com/microsoft/winget-pkgs
2. Add manifest to `manifests/w/wemux/wemux/`
3. Submit pull request
4. Users can install via: `winget install wemux`

**Advantages:**

- Free
- Simpler than Store
- Developer-friendly
- Good for power users

**Disadvantages:**

- No automatic updates UI
- Less discoverability
- Requires manual version updates

---

## 13. Troubleshooting Guide

### Common MSIX Issues

**Issue 1: "The package could not be registered"**

- **Solution:** Enable Developer Mode in Windows Settings
- **Alternative:** Sign package with trusted certificate

**Issue 2: Settings file not writable**

- **Solution:** Verify settings path uses `%LOCALAPPDATA%` for MSIX
- **Check:** Review settings.rs implementation

**Issue 3: Icons not displaying**

- **Solution:** Verify all icon files exist in `assets/` folder
- **Check:** Ensure PNG format and correct sizes

**Issue 4: App crashes on launch**

- **Solution:** Test non-MSIX version first
- **Debug:** Use `--debug` flag and check logs

**Issue 5: Audio capture fails**

- **Solution:** Verify `runFullTrust` capability in manifest
- **Check:** COM initialization working correctly

---

## 14. Next Steps

1. **Immediate:**

   - Update `src/tray/settings.rs` for MSIX compatibility
   - Create packaging directory structure
   - Generate icon assets

2. **Short-term (This Month):**

   - Register Partner Center account
   - Build and test local MSIX
   - Write privacy policy

3. **Medium-term (Next Month):**

   - Submit to Microsoft Store
   - Set up automated builds
   - Monitor first reviews

4. **Long-term:**
   - Iterate based on user feedback
   - Consider ARM64 build
   - Expand to WinGet distribution

---

## Resources

### Documentation

- [MSIX Packaging Documentation](https://docs.microsoft.com/en-us/windows/msix/)
- [Microsoft Store Policies](https://docs.microsoft.com/en-us/windows/apps/publish/store-policies)
- [Partner Center Guide](https://docs.microsoft.com/en-us/windows/apps/publish/)

### Tools

- [Windows SDK](https://developer.microsoft.com/en-us/windows/downloads/windows-sdk/)
- [MSIX Packaging Tool](https://www.microsoft.com/en-us/p/msix-packaging-tool/9n5lw3jbcxkf)
- [App Installer](https://www.microsoft.com/en-us/p/app-installer/9nblggh4nns1)

### Community

- [MSIX Tech Community](https://techcommunity.microsoft.com/t5/msix/ct-p/MSIX)
- [Windows Developer Discord](https://aka.ms/windowsdevelopers)

---

**Document Version:** 1.0
**Last Updated:** 2025-12-11
**Author:** Claude (Anthropic)
**Status:** Ready for Implementation
