# MSIX Packaging Guide for wemux

This directory contains all the necessary files and scripts to build MSIX packages for Microsoft Store distribution.

## üìÅ Directory Structure

```
packaging/
‚îú‚îÄ‚îÄ README.md              # This file
‚îú‚îÄ‚îÄ AppxManifest.xml       # MSIX package manifest (NEEDS CONFIGURATION)
‚îú‚îÄ‚îÄ assets/                # MSIX-specific icon assets (generated by script)
‚îÇ   ‚îú‚îÄ‚îÄ Square44x44Logo.png
‚îÇ   ‚îú‚îÄ‚îÄ Square71x71Logo.png
‚îÇ   ‚îú‚îÄ‚îÄ Square150x150Logo.png
‚îÇ   ‚îú‚îÄ‚îÄ Square310x310Logo.png
‚îÇ   ‚îú‚îÄ‚îÄ Wide310x150Logo.png
‚îÇ   ‚îú‚îÄ‚îÄ StoreLogo.png
‚îÇ   ‚îî‚îÄ‚îÄ SplashScreen.png
‚îú‚îÄ‚îÄ staging/               # Temporary build directory (auto-generated)
‚îî‚îÄ‚îÄ output/                # Final MSIX packages
```

## üöÄ Quick Start

### Prerequisites

1. **Install Windows 10 SDK**
   - Download from: https://developer.microsoft.com/en-us/windows/downloads/windows-sdk/
   - Includes `makeappx.exe` and `signtool.exe`

2. **Install ImageMagick** (for icon generation)
   ```powershell
   winget install ImageMagick.ImageMagick
   ```

3. **Rust Toolchain** (should already be installed)
   ```powershell
   rustup target add x86_64-pc-windows-msvc
   ```

### Step 1: Configure AppxManifest.xml

**IMPORTANT:** Before building, you MUST update `AppxManifest.xml` with your Microsoft Partner Center identity.

1. Go to https://partner.microsoft.com/dashboard
2. Login with your account: superyngo@hotmail.com
3. Navigate to your "wemux" app (create it if you haven't)
4. Go to **Product management** ‚Üí **Product Identity**
5. Copy these values:

   ```xml
   Package/Identity/Name: 12345YourPublisher.wemux
   Package/Identity/Publisher: CN=XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
   ```

6. Open `packaging/AppxManifest.xml` and replace:
   ```xml
   <!-- BEFORE -->
   <Identity
     Name="PLACEHOLDER.wemux"
     Publisher="CN=PLACEHOLDER"
     Version="0.3.0.0" />

   <!-- AFTER (with your actual values) -->
   <Identity
     Name="12345YourPublisher.wemux"
     Publisher="CN=XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"
     Version="0.3.0.0" />
   ```

7. Also update:
   ```xml
   <PublisherDisplayName>Your Name</PublisherDisplayName>
   ```
   to your actual name or company name.

### Step 2: Generate Icon Assets

```powershell
# From project root
.\scripts\generate_icons.ps1
```

This creates all 7 required MSIX icon assets in `packaging/assets/`.

**Verify:** Check that `packaging/assets/` contains:
- ‚úÖ Square44x44Logo.png
- ‚úÖ Square71x71Logo.png
- ‚úÖ Square150x150Logo.png
- ‚úÖ Square310x310Logo.png
- ‚úÖ Wide310x150Logo.png
- ‚úÖ StoreLogo.png
- ‚úÖ SplashScreen.png

### Step 3: Build MSIX Package

```powershell
# Build with default version from Cargo.toml
.\scripts\build_msix.ps1

# Or specify a version
.\scripts\build_msix.ps1 -Version 0.3.1.0

# Skip Rust build (use existing executable)
.\scripts\build_msix.ps1 -SkipBuild

# Sign package for local testing
.\scripts\build_msix.ps1 -Sign
```

The MSIX package will be created at:
```
packaging/output/wemux_0.3.0_x64.msix
```

## üß™ Local Testing

### Option 1: Enable Developer Mode (Recommended)

1. Open **Settings** ‚Üí **Privacy & Security** ‚Üí **For developers**
2. Enable **Developer Mode**
3. Double-click the MSIX file to install

### Option 2: Install via PowerShell

```powershell
Add-AppxPackage -Path "packaging\output\wemux_0.3.0_x64.msix"
```

### Option 3: Self-Signed Certificate (for testing without Developer Mode)

```powershell
# Generate certificate
$cert = New-SelfSignedCertificate -Type Custom -Subject "CN=wemux Dev" `
    -KeyUsage DigitalSignature -FriendlyName "wemux Dev Certificate" `
    -CertStoreLocation "Cert:\CurrentUser\My"

# Export certificate
$certPath = "packaging\wemux_dev_cert.pfx"
$certPassword = ConvertTo-SecureString -String "dev123" -Force -AsPlainText
Export-PfxCertificate -Cert $cert -FilePath $certPath -Password $certPassword

# Trust the certificate
Import-PfxCertificate -FilePath $certPath `
    -CertStoreLocation Cert:\LocalMachine\Root `
    -Password $certPassword

# Build and sign
.\scripts\build_msix.ps1 -Sign -CertPath $certPath
```

### Verify Installation

```powershell
# List installed package
Get-AppxPackage *wemux*

# Check settings location (MSIX uses LocalAppData)
explorer $env:LOCALAPPDATA\wemux
```

### Uninstall

```powershell
Get-AppxPackage *wemux* | Remove-AppxPackage
```

## üì§ Microsoft Store Submission

### 1. Prepare Store Listing

You'll need:

- [ ] **Screenshots** (3-10 images, minimum 1366√ó768)
  - System tray menu
  - Device selection
  - Settings view
  - Multi-monitor setup

- [ ] **Store Icon** (300√ó300 PNG)
  - Upload separately to Store
  - Can use `packaging/assets/Square310x310Logo.png` as base

- [ ] **Description** (see MSIX_STORE_PLAN.md for template)

- [ ] **Privacy Policy URL**
  - Use: `https://github.com/superyngo/wemux/blob/main/PRIVACY.md`

### 2. Upload to Partner Center

1. Go to https://partner.microsoft.com/dashboard
2. Navigate to your "wemux" app
3. Create a new submission
4. Upload `wemux_0.3.0_x64.msix`
5. Fill in Store listing:
   - App name: wemux
   - Category: Multimedia design ‚Üí Audio
   - Description: (see MSIX_STORE_PLAN.md)
   - Screenshots: (upload prepared images)
   - Privacy policy: GitHub URL
6. Complete age rating questionnaire
7. Submit for certification

### 3. Certification Timeline

- Automated testing: 1-3 hours
- Manual review: 1-3 business days
- **Total: Usually 24-48 hours**

## ü§ñ Automated Builds (CI/CD)

The `.github/workflows/msix-release.yml` workflow automatically builds MSIX packages when you create a git tag.

### Trigger a Build

```bash
# Create and push a tag
git tag v0.3.0
git push origin v0.3.0
```

The workflow will:
1. ‚úÖ Build the Rust application
2. ‚úÖ Generate icon assets
3. ‚úÖ Create MSIX package
4. ‚úÖ Upload to GitHub Releases
5. ‚úÖ Create release notes

### Download from GitHub

After the workflow completes:
1. Go to https://github.com/superyngo/wemux/releases
2. Download `wemux_0.3.0_x64.msix`
3. Upload to Microsoft Store

## üìã Checklist for First Submission

Before submitting to Microsoft Store:

### AppxManifest.xml Configuration
- [ ] Replace `PLACEHOLDER.wemux` with your Partner Center app name
- [ ] Replace `CN=PLACEHOLDER` with your Partner Center publisher ID
- [ ] Update `PublisherDisplayName` with your name

### Assets
- [ ] Generated all 7 icon assets using `generate_icons.ps1`
- [ ] Reviewed icons for quality (optional: manually edit for better appearance)
- [ ] Created 3-10 screenshots (1366√ó768 minimum)
- [ ] Created 300√ó300 Store icon

### Documentation
- [ ] Privacy policy published at GitHub (PRIVACY.md)
- [ ] README updated with current version
- [ ] Release notes prepared

### Testing
- [ ] Built MSIX package successfully
- [ ] Installed and tested locally
- [ ] Verified settings storage in `%LOCALAPPDATA%\wemux`
- [ ] Tested audio capture and device selection
- [ ] Verified tray icon functionality

### Store Preparation
- [ ] Microsoft Partner Center account ready
- [ ] App name "wemux" reserved
- [ ] Store listing description written
- [ ] Age rating questionnaire completed
- [ ] Pricing set to "Free"

## üõ†Ô∏è Troubleshooting

### "makeappx.exe not found"
- Install Windows 10 SDK
- Add SDK bin folder to PATH: `C:\Program Files (x86)\Windows Kits\10\bin\10.0.22621.0\x64`

### "ImageMagick not found"
```powershell
winget install ImageMagick.ImageMagick
# Restart PowerShell after installation
```

### "Package could not be registered"
- Enable Developer Mode in Windows Settings
- Or sign the package with a trusted certificate

### "Settings file not writable"
- MSIX packages have read-only install directories
- Settings are automatically stored in `%LOCALAPPDATA%\wemux\wemux.toml`
- This is handled by the modified `settings.rs`

### Icons not displaying correctly
- Ensure all 7 icons exist in `packaging/assets/`
- Icons must be PNG format with transparency
- Regenerate with `generate_icons.ps1`

## üìö Resources

- [MSIX Documentation](https://docs.microsoft.com/windows/msix/)
- [Microsoft Store Policies](https://docs.microsoft.com/windows/apps/publish/store-policies)
- [Partner Center Guide](https://docs.microsoft.com/windows/apps/publish/)
- [Full Implementation Plan](../MSIX_STORE_PLAN.md)

## üí° Tips

1. **Test Early, Test Often**
   - Test MSIX installation on a clean Windows VM
   - Verify all features work in MSIX environment

2. **Icon Quality Matters**
   - Consider manually refining auto-generated icons
   - Follow Microsoft Fluent Design guidelines
   - Test icons on both light and dark themes

3. **Screenshots Sell**
   - Show the app in action
   - Highlight key features
   - Use high-quality, professional screenshots

4. **Versioning**
   - MSIX requires 4-part version: `0.3.0.0`
   - Increment for each Store submission
   - Keep in sync with Cargo.toml

5. **Keep Users Updated**
   - Use GitHub Releases for release notes
   - Microsoft Store handles automatic updates
   - Consider maintaining a changelog

## üÜò Support

- **Issues:** https://github.com/superyngo/wemux/issues
- **Email:** superyngo@hotmail.com
- **Partner Center Help:** https://partner.microsoft.com/support

---

**Last Updated:** 2025-12-11
**Document Version:** 1.0
